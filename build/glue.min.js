!function(){var a=function(){var a=0;return function(){return a++}}();Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});var b=function(){var b=function(b){this.id=a(),this.nexuses={},this.instances={},this.parent=b};return b.fn=b.prototype,b.fn.getInstance=function(){var a=new b(this);return this.instances[a.id]=a,a},b.fn.removeInstance=function(a){delete this.instances[a.id]},b.fn.destroy=function(){for(var a in this.nexuses)if(this.nexuses.hasOwnProperty(a)){var b=this.nexuses[a];b.destroy()}for(var c in this.instances)this.instances.hasOwnProperty(c)&&this.instances[c].destroy();this.parent&&this.parent.removeInstance(this)},b.fn.getObjectId=function(b){var c="##glueObjectId##";return b[c]||(b[c]=a()),b[c]},b.fn.callback=function(a,b){var c;if("function"==typeof a?c=a:b&&"object"==typeof b&&"function"==typeof b[a]?c=b[a]:"function"==typeof window[a]&&(c=window[a]),!c)throw new Error("accessor must be valid callback");return b&&"object"==typeof b&&(c=c.bind(b)),c},b}();!function(a){var b="__glueListener",c=function(a,b){this.method=a,this.object=b,this.nexuses={}};a.fn.Listener=c;var d=c.prototype;d.replace=function(){var a=this,c=this.object[this.method];this.object[this.method]=function(){var b,d=Array.prototype.slice.call(arguments),e=this;return b=c.apply(e,d),a.invoke(d,e),b},this.object[this.method][b]=this},d.invoke=function(a,b){var c=this.nexuses;for(var d in c)c.hasOwnProperty(d)&&(c[d].args=a,c[d].invokeContext(b))},d.addObserver=function(a){this.nexuses[a.id]=a,a.listener=this},d.removeNexus=function(a){delete this.nexuses[a]},a.fn.getListener=function(a,d){if(!(a in d))throw new Error("Method not exists");var e=d[a];if(e[b]&&d.hasOwnProperty(a))return e[b];var f=new c(a,d);return f.replace(),f}}(b),function(b){var c=function(){this.id=a(),this.callback=null,this.listener=null};b.fn.Nexus=c;var d=c.prototype;d.setCallback=function(a,b){return a&&(this.callback=this.instance.callback(a,b)),this},d.once=function(){var a=this.callback,b=this;return this.callback=function(){a.apply(this,[].slice.call(arguments)),b.destroy()},this},d.async=function(a){var b=this.callback;return this.callback=function(){setTimeout(function(){b.apply(this,[].slice.call(arguments))},a||10)},this},d.invoke=function(){this.invokeContext(this)},d.invokeContext=function(a){try{this.callback.call(a,this)}catch(b){console.error(b)}},d.destroy=function(){delete this.instance.nexuses[this.id],this.listener&&this.listener.removeNexus(this.id)},b.fn.getNexus=function(){var a=new c;return a.instance=this,this.nexuses[a.id]=a,a}}(b),function(a){a.fn.observer=function(a,b,c,d){if(!b)throw new Error('Object passed to observer have unsupported type "'+typeof b+'"');if(a instanceof Array)return a.map(function(a){return this.observer(a,b,c,d)},this);if(!(a in b))throw new Error("Method "+a+" not exists");var e=this.getNexus(),f=this.getListener(a,b);return f.addObserver(e),c&&e.setCallback(c,d),e}}(b);var c=new b;c.fn=b.fn,c.util={uniqueId:a},"undefined"!=typeof this.define?this.define("glue",function(){return c}):this.glue=c}();